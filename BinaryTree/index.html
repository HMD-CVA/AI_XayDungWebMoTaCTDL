<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BST Visualization</title>
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- D3.js -->
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link rel="stylesheet" href="home.css">
</head>
<body>
    <div class="app-container">
        <!-- App Header -->
        <div class="app-header" id="appHeader">
            <div class="app-title">
                <span>üå≥</span> Binary Search Tree Visualization
            </div>
            <div class="header-controls">
                <button class="btn btn-info btn-sm me-2" onclick="openGuideModal()" title="H∆∞·ªõng d·∫´n s·ª≠ d·ª•ng">
                    <span>‚ùì</span> H∆∞·ªõng d·∫´n
                </button>
                <button class="btn btn-light btn-sm" onclick="toggleControls()">
                    <span id="toggleIcon">‚ñ≤</span>
                </button>
            </div>
        </div>
        
        <!-- Show Controls Button (visible when collapsed) -->
        <div class="show-controls-container" id="showControlsContainer">
            <button class="btn btn-show-controls" onclick="toggleControls()">
                <span>‚ñº</span>
            </button>
        </div>
        
        <!-- Control Bar -->
        <div class="control-bar" id="controlBar">
            <div class="control-content">
                <!-- H√†ng 1: Kh·ªüi t·∫°o + Kh√°c + Node + Bound + Min/Max -->
                <div class="control-row">
                    <!-- Kh·ªüi t·∫°o c√¢y -->
                    <div class="ctrl-section">
                        <span class="section-label">üå≥ Kh·ªüi T·∫°o C√¢y</span>
                        <div class="section-controls">
                            <input type="number" id="nodeCount" class="form-control form-control-sm" placeholder="S·ªë node" min="1" max="20">
                            <select id="treeType" class="form-select form-select-sm">
                                <option value="balanced" selected>C√¢n b·∫±ng</option>
                                <option value="perfect">Ho√†n h·∫£o</option>
                                <option value="minavl">MinAVL</option>
                                <option value="unbalanced">Kh√¥ng c√¢n b·∫±ng</option>
                                <option value="right-skewed">L·ªách ph·∫£i</option>
                                <option value="left-skewed">L·ªách tr√°i</option>
                            </select>
                            <button class="btn btn-success btn-sm" onclick="createRandomTree()">üé≤ T·∫°o Ng·∫´u Nhi√™n</button>
                        </div>
                    </div>
                    
                    <div class="section-divider"></div>
                    
                    <!-- C√¢n b·∫±ng & X√≥a -->
                    <div class="ctrl-section">
                        <span class="section-label">‚öôÔ∏è Kh√°c</span>
                        <div class="section-controls">
                            <button class="btn btn-primary btn-sm" onclick="balanceTree()">‚öñÔ∏è C√¢n B·∫±ng</button>
                            <button class="btn btn-warning btn-sm" onclick="resetTree()">üîÑ Reset</button>
                            <button class="btn btn-danger btn-sm" onclick="clearTree()">üóëÔ∏è X√≥a C√¢y</button>
                        </div>
                    </div>
                    
                    <div class="section-divider"></div>
                    
                    <!-- Thao t√°c Node -->
                    <div class="ctrl-section">
                        <span class="section-label">üìù Node</span>
                        <div class="section-controls">
                            <input type="number" id="nodeValue" class="form-control form-control-sm" placeholder="Gi√° tr·ªã" min="-9999" max="9999">
                            <button class="btn btn-primary btn-sm" onclick="insertNode()">‚ûï Th√™m</button>
                            <button class="btn btn-warning btn-sm" onclick="findNode()">üîç T√¨m</button>
                            <button class="btn btn-danger btn-sm" onclick="deleteSelectedNode()">‚ùå X√≥a</button>
                        </div>
                    </div>
                    
                    <div class="section-divider"></div>
                    
                    <!-- Bound -->
                    <div class="ctrl-section">
                        <span class="section-label">üéØ Bound</span>
                        <div class="section-controls">
                            <input type="number" id="boundValue" class="form-control form-control-sm" placeholder="Gi√° tr·ªã" min="-9999" max="9999">
                            <button class="btn btn-info btn-sm" onclick="findLowerBound()">‚¨áÔ∏è Lower</button>
                            <button class="btn btn-info btn-sm" onclick="findUpperBound()">‚¨ÜÔ∏è Upper</button>
                        </div>
                    </div>
                    
                    <div class="section-divider"></div>
                    
                    <!-- Min/Max -->
                    <div class="ctrl-section">
                        <span class="section-label">üìä Min/Max</span>
                        <div class="section-controls">
                            <button class="btn btn-success btn-sm" onclick="findMin()">‚¨áÔ∏è Min</button>
                            <button class="btn btn-success btn-sm" onclick="findMax()">‚¨ÜÔ∏è Max</button>
                        </div>
                    </div>
                </div>
                
                <!-- H√†ng 2: Nh·∫≠p gi√° tr·ªã + Duy·ªát -->
                <div class="control-row">
                    <!-- Nh·∫≠p gi√° tr·ªã c·ª• th·ªÉ -->
                    <div class="ctrl-section flex-grow">
                        <span class="section-label">‚úçÔ∏è Nh·∫≠p Gi√° Tr·ªã</span>
                        <div class="section-controls">
                            <input type="text" id="nodeValues" class="form-control form-control-sm" placeholder="Nh·∫≠p nhi·ªÅu gi√° tr·ªã c√°ch nhau b·ªüi d·∫•u ph·∫©y (vd: 10,20,30,40,50)">
                            <button class="btn btn-primary btn-sm" onclick="createTreeFromInput()">T·∫°o C√¢y</button>
                        </div>
                    </div>
                    
                    <div class="section-divider"></div>
                    
                    <!-- Duy·ªát -->
                    <div class="ctrl-section">
                        <span class="section-label">üîÑ Duy·ªát C√¢y</span>
                        <div class="section-controls">
                            <button class="btn btn-outline-secondary btn-sm" onclick="traverseTree('preorder')">Pre-order</button>
                            <button class="btn btn-outline-secondary btn-sm" onclick="traverseTree('inorder')">In-order</button>
                            <button class="btn btn-outline-secondary btn-sm" onclick="traverseTree('postorder')">Post-order</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Main Content -->
        <div class="main-content">
            <!-- Graph Container -->
            <div class="graph-container" id="graphContainer">
                <svg id="treeSVG"></svg>
                
                <!-- Result Panel -->
                <div class="result-panel collapsed" id="resultPanel">
                    <button class="close-result-btn" onclick="toggleResultPanel()">√ó</button>
                    <div class="result-content" id="resultContent">K·∫øt qu·∫£ s·∫Ω hi·ªÉn th·ªã ·ªü ƒë√¢y</div>
                </div>
                <button class="toggle-result-btn" id="toggleResultBtn" onclick="toggleResultPanel()">
                    üìÑ
                </button>
                
                <!-- Algorithm Panel -->
                <div class="algorithm-panel collapsed" id="algorithmPanel">
                    <button class="close-algorithm-btn" onclick="toggleAlgorithmPanel()">√ó</button>
                    <pre class="algorithm-code" id="algorithmCode">Ch·ªçn m·ªôt thao t√°c ƒë·ªÉ xem thu·∫≠t to√°n</pre>
                </div>
                <button class="toggle-algorithm-btn" id="toggleAlgorithmBtn" onclick="toggleAlgorithmPanel()">
                    üìù
                </button>
                
                <!-- Legend -->
                <!-- Stats -->
                <div class="stats-panel collapsed" id="statsPanel">
                    <div class="stats-title">
                        <span>üìä Th·ªëng K√™</span>
                        <button class="close-stats-btn" onclick="toggleStatsPanel()">√ó</button>
                    </div>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <span>T·ªïng Nodes:</span>
                            <span class="stat-value" id="nodeCountDisplay">0</span>
                        </div>
                        <div class="stat-item">
                            <span>Chi·ªÅu Cao:</span>
                            <span class="stat-value" id="treeHeight">0</span>
                        </div>
                        <div class="stat-item">
                            <span>Node ƒêang Ch·ªçn:</span>
                            <span class="stat-value" id="selectedValue">-</span>
                        </div>
                        <div class="stat-item">
                            <span>Tr·∫°ng Th√°i BST:</span>
                            <span class="stat-value" id="balanceStatus">‚úì</span>
                        </div>
                    </div>
                </div>
                <button class="toggle-stats-btn" id="toggleStatsBtn" onclick="toggleStatsPanel()">
                    üìä
                </button>
            </div>
        </div>
    </div>

    <!-- Animation Control Bar -->
    <div class="animation-control-bar" id="animationControlBar">
        <div class="control-bar-content">
            <button class="control-btn" id="prevStepBtn" onclick="prevStep()" title="B∆∞·ªõc tr∆∞·ªõc">
                <span>‚è™</span>
            </button>
            <button class="control-btn" id="playPauseBtn" onclick="togglePlayPause()" title="T·∫°m d·ª´ng/Ti·∫øp t·ª•c">
                <span id="playPauseIcon">‚è∏Ô∏è</span>
            </button>
            <button class="control-btn" id="nextStepBtn" onclick="nextStep()" title="B∆∞·ªõc ti·∫øp">
                <span>‚è©</span>
            </button>
            
            <div class="timeline-container">
                <span class="step-indicator" id="stepIndicator">0/0</span>
                <input type="range" class="timeline-slider" id="timelineSlider" min="0" max="0" value="0" disabled>
                <span class="time-display" id="timeDisplay">0:00</span>
            </div>
            
            <div class="speed-control">
                <label for="speedSelect">‚ö°</label>
                <select class="speed-select" id="speedSelect" onchange="changeSpeed()">
                    <option value="600">0.5x</option>
                    <option value="400" selected>1x</option>
                    <option value="200">2x</option>
                    <option value="133">3x</option>
                    <option value="100">4x</option>
                    <option value="80">5x</option>
                </select>
            </div>
        </div>
    </div>

    <!-- Tour Guide Overlay -->
    <div id="tourOverlay" class="tour-overlay" style="display: none;">
        <div id="tourSpotlight" class="tour-spotlight"></div>
        <div id="tourPopup" class="tour-popup">
            <div class="tour-header">
                <span id="tourStep" class="tour-step">1/10</span>
                <button id="tourSkip" class="tour-skip">B·ªè qua</button>
            </div>
            <div class="tour-body">
                <h5 id="tourTitle" class="tour-title"></h5>
                <div id="tourContent" class="tour-content"></div>
            </div>
            <div class="tour-footer">
                <button id="tourPrev" class="tour-btn tour-btn-prev" disabled>Tr∆∞·ªõc</button>
                <button id="tourNext" class="tour-btn tour-btn-next">Ti·∫øp</button>
            </div>
        </div>
    </div>

    <!-- Modal H∆∞·ªõng d·∫´n s·ª≠ d·ª•ng -->
    <div class="modal fade" id="guideModal" tabindex="-1" aria-labelledby="guideModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="guideModalLabel">Binary Search Tree (C√¢y T√¨m Ki·∫øm Nh·ªã Ph√¢n)</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <!-- Ph·∫ßn 1: L√Ω thuy·∫øt c∆° b·∫£n -->
                    <div class="guide-section">
                        <h6 class="guide-title">1. Gi·ªõi Thi·ªáu Binary Search Tree (BST)</h6>
                        <p><strong>ƒê·ªãnh nghƒ©a:</strong> Binary Search Tree l√† c√¢y nh·ªã ph√¢n c√≥ t√≠nh ch·∫•t:</p>
                        <ul>
                            <li>M·ªói node c√≥ t·ªëi ƒëa 2 con (tr√°i v√† ph·∫£i)</li>
                            <li><strong>T√≠nh ch·∫•t BST:</strong> V·ªõi m·ªói node X:
                                <ul>
                                    <li>T·∫•t c·∫£ node ·ªü c√¢y con tr√°i c√≥ gi√° tr·ªã < X</li>
                                    <li>T·∫•t c·∫£ node ·ªü c√¢y con ph·∫£i c√≥ gi√° tr·ªã > X</li>
                                </ul>
                            </li>
                            <li><strong>·ª®ng d·ª•ng:</strong> T√¨m ki·∫øm, s·∫Øp x·∫øp, l∆∞u tr·ªØ d·ªØ li·ªáu c√≥ th·ª© t·ª±</li>
                        </ul>
                    </div>

                    <!-- Ph·∫ßn 2: ƒê·ªô ph·ª©c t·∫°p -->
                    <div class="guide-section">
                        <h6 class="guide-title">2. ƒê·ªô Ph·ª©c T·∫°p Thu·∫≠t To√°n</h6>
                        <table class="complexity-table">
                            <thead>
                                <tr>
                                    <th>Thao t√°c</th>
                                    <th>Tr∆∞·ªùng h·ª£p t·ªët</th>
                                    <th>Tr∆∞·ªùng h·ª£p x·∫•u</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>T√¨m ki·∫øm (Search)</td>
                                    <td>O(log n)</td>
                                    <td>O(n)</td>
                                </tr>
                                <tr>
                                    <td>Th√™m (Insert)</td>
                                    <td>O(log n)</td>
                                    <td>O(n)</td>
                                </tr>
                                <tr>
                                    <td>X√≥a (Delete)</td>
                                    <td>O(log n)</td>
                                    <td>O(n)</td>
                                </tr>
                            </tbody>
                        </table>
                        <p class="note"><em>* Tr∆∞·ªùng h·ª£p x·∫•u x·∫£y ra khi c√¢y l·ªách (skewed tree)</em></p>
                    </div>

                    <!-- Ph·∫ßn 3: C√°c thao t√°c c∆° b·∫£n -->
                    <div class="guide-section">
                        <h6 class="guide-title">3. C√°c Thao T√°c C∆° B·∫£n</h6>
                        
                        <p><strong>3.1. T√¨m ki·∫øm (Search)</strong></p>
                        <ul>
                            <li>So s√°nh gi√° tr·ªã c·∫ßn t√¨m v·ªõi node hi·ªán t·∫°i</li>
                            <li>N·∫øu nh·ªè h∆°n ‚Üí ƒëi sang tr√°i, l·ªõn h∆°n ‚Üí ƒëi sang ph·∫£i</li>
                            <li>L·∫∑p l·∫°i cho ƒë·∫øn khi t√¨m th·∫•y ho·∫∑c g·∫∑p null</li>
                        </ul>

                        <p><strong>3.2. Th√™m node (Insert)</strong></p>
                        <ul>
                            <li>T√¨m v·ªã tr√≠ ph√π h·ª£p theo quy t·∫Øc BST</li>
                            <li>Node m·ªõi lu√¥n ƒë∆∞·ª£c th√™m ·ªü v·ªã tr√≠ l√° (leaf)</li>
                            <li>Gi√° tr·ªã kh√¥ng ƒë∆∞·ª£c tr√πng l·∫∑p</li>
                        </ul>

                        <p><strong>3.3. X√≥a node (Delete)</strong></p>
                        <ul>
                            <li><strong>TH1:</strong> Node l√° ‚Üí X√≥a tr·ª±c ti·∫øp</li>
                            <li><strong>TH2:</strong> Node c√≥ 1 con ‚Üí Con thay th·∫ø v·ªã tr√≠ node</li>
                            <li><strong>TH3:</strong> Node c√≥ 2 con ‚Üí T√¨m node l·ªõn nh·∫•t b√™n tr√°i ho·∫∑c nh·ªè nh·∫•t b√™n ph·∫£i ƒë·ªÉ thay th·∫ø</li>
                        </ul>
                    </div>

                    <!-- Ph·∫ßn 4: Duy·ªát c√¢y -->
                    <div class="guide-section">
                        <h6 class="guide-title">4. C√°c Ph∆∞∆°ng Ph√°p Duy·ªát C√¢y</h6>
                        <ul>
                            <li><strong>Pre-order (NLR):</strong> G·ªëc ‚Üí Tr√°i ‚Üí Ph·∫£i
                                <br><em>·ª®ng d·ª•ng: Copy c√¢y, t·∫°o prefix expression</em>
                            </li>
                            <li><strong>In-order (LNR):</strong> Tr√°i ‚Üí G·ªëc ‚Üí Ph·∫£i
                                <br><em>·ª®ng d·ª•ng: L·∫•y c√°c node theo th·ª© t·ª± tƒÉng d·∫ßn</em>
                            </li>
                            <li><strong>Post-order (LRN):</strong> Tr√°i ‚Üí Ph·∫£i ‚Üí G·ªëc
                                <br><em>·ª®ng d·ª•ng: X√≥a c√¢y, t√≠nh bi·ªÉu th·ª©c postfix</em>
                            </li>
                        </ul>
                    </div>

                    <!-- Ph·∫ßn 5: Kh√°i ni·ªám n√¢ng cao -->
                    <div class="guide-section">
                        <h6 class="guide-title">5. Kh√°i Ni·ªám N√¢ng Cao</h6>
                        
                        <p><strong>5.1. C√¢n b·∫±ng c√¢y (Balancing)</strong></p>
                        <ul>
                            <li><strong>ƒê·ªô l·ªách (Balance Factor):</strong> chi·ªÅu cao c√¢y tr√°i - chi·ªÅu cao c√¢y ph·∫£i</li>
                            <li><strong>C√¢y c√¢n b·∫±ng:</strong> |BF| ‚â§ 1 t·∫°i m·ªçi node</li>
                            <li><strong>C√°c ph√©p xoay:</strong> Left, Right, Left-Right, Right-Left</li>
                        </ul>

                        <p><strong>5.2. Lower Bound & Upper Bound</strong></p>
                        <ul>
                            <li><strong>Lower Bound(x):</strong> Gi√° tr·ªã nh·ªè nh·∫•t ‚â• x</li>
                            <li><strong>Upper Bound(x):</strong> Gi√° tr·ªã nh·ªè nh·∫•t > x</li>
                            <li>H·ªØu √≠ch trong t√¨m ki·∫øm kho·∫£ng, truy v·∫•n tr√™n kho·∫£ng</li>
                        </ul>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ƒê√≥ng</button>
                    <button type="button" class="btn btn-primary" id="startTourBtn" onclick="startTourFromModal()" style="display: none;">B·∫Øt ƒê·∫ßu Tour H∆∞·ªõng D·∫´n</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script src="home.js"></script>
</body>
</html>